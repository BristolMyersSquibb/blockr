<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="blockr">
<title>Developer guide â€¢ blockr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Developer guide">
<meta property="og:description" content="blockr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link href="https://raw.githubusercontent.com/rstudio/bslib/main/inst/components/dist/card/card.min.js">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@latest/font/bootstrap-icons.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-info" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">blockr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/blockr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>User Guide</h6>
    <a class="dropdown-item" href="../articles/data-blocks.html">1. Data blocks</a>
    <a class="dropdown-item" href="../articles/registry.html">2. Blocks registry</a>
    <a class="dropdown-item" href="../articles/plot-block.html">3. Case study: create a plot block</a>
    <a class="dropdown-item" href="../articles/developer-guide.html">Developer guide</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <h6 class="dropdown-header" data-toc-skip>blockr 0.0.2</h6>
    <h6 class="dropdown-header" data-toc-skip>blockr 0.0.1.9000</h6>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <h6 class="dropdown-header" data-toc-skip>blockr 0.0.2</h6>
    <h6 class="dropdown-header" data-toc-skip>blockr 0.0.1.9000</h6>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../#dark-mode"></a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<link href="developer-guide_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="developer-guide_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="developer-guide_files/d3-3.3.8/d3.min.js"></script><script src="developer-guide_files/dagre-0.4.0/dagre-d3.min.js"></script><script src="developer-guide_files/mermaid-10.6.0/dist/mermaid.slim.min.js"></script><link href="developer-guide_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="developer-guide_files/chromatography-0.1/chromatography.js"></script><script src="developer-guide_files/DiagrammeR-binding-1.0.10.9000/DiagrammeR.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Developer guide</h1>
            
      
      
      <div class="d-none name"><code>developer-guide.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="blockr-structure">
<code>{blockr}</code> structure<a class="anchor" aria-label="anchor" href="#blockr-structure"></a>
</h2>
<p>Under the hood, <code>{blockr}</code> utilises S3 to creates classes
and apply the relevant methods whenever necessary. We describe the
general idea below.</p>
<div class="section level3">
<h3 id="workspace">Workspace<a class="anchor" aria-label="anchor" href="#workspace"></a>
</h3>
<p>TBD</p>
</div>
<div class="section level3">
<h3 id="stack">Stack<a class="anchor" aria-label="anchor" href="#stack"></a>
</h3>
<p>The stack is a list of blocks.</p>
<div class="DiagrammeR html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"\nclassDiagram\n    class stack\n    stack : +name\n    stack : +class\n    stack : +generate_server(stack, ...)\n"},"evals":[],"jsHooks":[]}</script><p>The stack is able to dynamically add new blocks through
<code><a href="../reference/add_block.html">add_block()</a></code>.</p>
<div class="section level4">
<h4 id="modify-a-stack">Modify a stack<a class="anchor" aria-label="anchor" href="#modify-a-stack"></a>
</h4>
<p>To add a block to a stack, you can leverage
<code><a href="../reference/add_block.html">add_block()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stack.html">new_stack</a></span><span class="op">(</span><span class="va">dataset_block</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_block.html">add_block</a></span><span class="op">(</span><span class="va">select_block</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_block.html">add_block</a></span><span class="op">(</span><span class="va">filter_block</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>If you specify the position (last parameter), you can add a block
right after the given index. For instance, the above command first
inserts a select block after the data block. Then, a filter block is
included right after the data block.</p>
<p>Note that you canâ€™t add a block before the data block and before the
plot block. In a later version, we may add multiple plots per stack.</p>
</div>
<div class="section level4">
<h4 id="moving-blocks">Moving blocks<a class="anchor" aria-label="anchor" href="#moving-blocks"></a>
</h4>
<p>TBD</p>
</div>
</div>
<div class="section level3">
<h3 id="blocks">Blocks<a class="anchor" aria-label="anchor" href="#blocks"></a>
</h3>
<p>A block is a structure carrying various information:</p>
<ul>
<li>The <strong>class</strong>: <code>{blockr}</code> leverages S3, so
the class is important to apply the right methods. For instance, data
block, tranform and output blocks have different methods
(<code>generate_server.data_block</code>, â€¦, respectively).</li>
<li>
<strong>expr</strong>: is the expression which will be evaluated to
produce the block <strong>result</strong>.</li>
<li>
<strong>result</strong>: the block output which can be passed to
another block.</li>
</ul>
<div class="DiagrammeR html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"diagram":"\nclassDiagram\n    class block\n    block : +name\n    block : +expr\n    block : +result\n    block : +layout\n    block : +class\n    block : +initialize_block(block)\n    block : +is_initialized(block)\n    block : +generate_code(block)\n    block : +evaluate_block(block, ...)\n    block : +generate_server(block, ...)\n    block : +update_fields(block, ...)\n"},"evals":[],"jsHooks":[]}</script><p>A block is composed of <strong>fields</strong> gathered in a list,
which are translated into Shiny inputs. These fields are the necessary
elements to reconstruct the block <strong>expression</strong> and
subsequently produce the result whenever it gets evaluated.</p>
</div>
<div class="section level3">
<h3 id="fields">Fields<a class="anchor" aria-label="anchor" href="#fields"></a>
</h3>
<div class="section level4">
<h4 id="simple-fields">Simple fields<a class="anchor" aria-label="anchor" href="#simple-fields"></a>
</h4>
<p>A field is a structure with a <strong>type</strong> and a
<strong>class</strong>.</p>
<div class="DiagrammeR html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"diagram":"\nclassDiagram\n    class field\n    field : +type\n    field : +class\n    field : +initialize_field(x, env)\n    field : +validate_field(field)\n    field : +update_field(field, value, ...)\n"},"evals":[],"jsHooks":[]}</script><p>The <code>validate_field</code> generic ensures each field has
revelant values. For instance, for a string field, which ultimately
becomes a shiny text input, the method
<code>validate_field.string_field</code> is responsible for checking
that the value is a character string and modifies it if not.</p>
</div>
<div class="section level4">
<h4 id="more-complex-fields">More complex fields<a class="anchor" aria-label="anchor" href="#more-complex-fields"></a>
</h4>
<p>TBD</p>
</div>
</div>
<div class="section level3">
<h3 id="validation-and-evaluation">Validation and evaluation<a class="anchor" aria-label="anchor" href="#validation-and-evaluation"></a>
</h3>
<p>Thatâ€™s currently how {blockr} validate blocks and fields. Each block
is validated, meaning that each field that compose it should have valid
values according to the input data. Only when everything is valid, the
block expression is evaluated and the result computed and passed to the
next block. Any error is catched by R and forwarded to JavaScript so
that users are notified about what went wrong and where.</p>
<div id="htmlwidget-febe03efa1a2d8d52a86" style="width:700px;height:1200px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"diagram":"\nflowchart TD;\n  subgraph stack\n    subgraph blk1\n      block1[Block 1] --> |check fields| validate_block1[Validation] --> validate_block1_ok[OK]\n      validate_block1 --> validate_block1_fail[Fail]\n      validate_block1_ok --> |evaluate| try_eval[Try] --> eval_block1_ok[OK] --> data_block1[Data]\n      eval_block1_ok[Success]\n      try_eval --> eval_block1_fail[Fail]\n    end\n    data_block1 -.-> block2\n    subgraph blk2\n      block2[Block2] --> |check fields| validate_block2[Validation] --> validate_block2_ok[OK]\n    \n      validate_block2 --> validate_block2_fail[Fail]\n      validate_block2_ok --> |evaluate| try_eval2[Try] --> eval_block2_ok[OK] --> data_block2[Data]\n      eval_block2_ok[Success]\n      try_eval2 --> eval_block2_fail[Fail]\n    end\n    data_block2 -.-> stack_result[Stack result]\n  end\n  eval_block1_fail -.-x |notification| gui\n  eval_block2_fail -.-x |notification| gui\n  validate_block1_fail -.-x |notification| gui\n  validate_block2_fail -.-x |notification| gui\n  subgraph ui\n      gui[User interface]\n  end\n"},"evals":[],"jsHooks":{"render":[{"code":"\n    function(el, x) {\n      el.classList.add('text-center')\n    }\n  ","data":null}]}}</script>
</div>
</div>
<div class="section level2">
<h2 id="adding-new-fields">Adding new fields<a class="anchor" aria-label="anchor" href="#adding-new-fields"></a>
</h2>
<p>Fields are translated into shiny inputs. For instance, the
<code>select_field</code> surprinsingly yields a shiny
<code>selectInput</code>. It is quite easy to add a new field:</p>
<ol style="list-style-type: decimal">
<li>Under <code>./R/field.R</code>, create a new
<code>new_*_field</code> and <code>*_field</code> functions,
<code>*</code> being the field name.</li>
<li>Under <code>./R/field.R</code>, add a specific validation method
<code>validate_field.*_field</code>.</li>
<li>Under <code>./R/ui.R</code>, add <code>ui_input.*_field</code> and
<code>ui_update.*_field</code> to create the corresponding HTML element
for Shiny.</li>
</ol>
</div>
<div class="section level2">
<h2 id="create-a-new-block">Create a new block<a class="anchor" aria-label="anchor" href="#create-a-new-block"></a>
</h2>
<p>You may find yourself in a situation where the set of existing blocks
does not fully meet your needs. We exposed few helpers so you can
quickly get started creating new block. You can call
<code>create_block</code> choosing between <code>transform</code> or
<code>plot</code> block. This creates a new block file in
<code>R/&lt;name&gt;-block.R</code>.</p>
<p>If your block has specific output, you may need to tweak
<code>./R/server.R</code>:</p>
<ol style="list-style-type: decimal">
<li>Add a <code>server_output.*_block</code> method, <code>*</code>
being the new block name.</li>
<li>Add a specific <code>generate_server.*_block</code>.</li>
</ol>
<p>If you had to include new fields, refer to the previous section.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicolas Bennett, David Granjon, John Coene, Bristol Myers Squibb.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
